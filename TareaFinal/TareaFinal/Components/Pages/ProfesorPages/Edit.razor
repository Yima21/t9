@page "/profesors/edit"
@using Microsoft.EntityFrameworkCore
@using TareaFinal.Modelos
@inject IDbContextFactory<TareaFinal.Modelos.AppDbContext> DbFactory
@inject NavigationManager NavigationManager
@inject TareaFinal.Modelos.AppDbContext DB

<PageTitle>Editar Profesor</PageTitle>
<h2 class="centrar"><b>Editar Profesor</b></h2>


<hr />
@if (Profesor is null)
{
    <p><em>Cargando...</em></p>
}
else
{
    <div class="row">
        <EditForm method="post" Model="Profesor" OnValidSubmit="UpdateProfesor" FormName="edit" Enhance>
            <DataAnnotationsValidator />
            <ValidationSummary role="alert" />
            <input type="hidden" name="Profesor.Id" value="@Profesor.Id" />
            <div class="row">
                <div class="col-md-3">
                    <label for="codigo" class="form-label"><b>Código</b></label>
                    <InputText id="codigo" @bind-Value="Profesor.Codigo" class="form-control" />
                    <ValidationMessage For="() => Profesor.Codigo" class="text-danger" />
                </div>
                <div class="col-md-3">
                    <label for="cedula" class="form-label"><b>Cédula</b></label>
                    <InputText id="cedula" @bind-Value="Profesor.Cedula" class="form-control" />
                    <ValidationMessage For="() => Profesor.Cedula" class="text-danger" />
                </div>
                <div class="col-md-3">
                    <label for="fechanacimiento" class="form-label"><b>Fecha de Nacimiento</b></label>
                    <InputDate id="fechanacimiento" @bind-Value="Profesor.FechaNacimiento" class="form-control" aria-required="true" />
                    <ValidationMessage For="() => Profesor.FechaNacimiento" class="text-danger" />
                </div>
                <div class="col-md-3">
                    <label for="fechaingreso" class="form-label"><b>Fecha de Ingreso</b></label>
                    <InputDate id="fechaingreso" @bind-Value="Profesor.FechaIngreso" class="form-control" />
                    <ValidationMessage For="() => Profesor.FechaIngreso" class="text-danger" />
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <label for="nombre" class="form-label"><b>Nombre</b></label>
                    <InputText id="nombre" @bind-Value="Profesor.Nombre" class="form-control" aria-required="true" />
                    <ValidationMessage For="() => Profesor.Nombre" class="text-danger" />
                </div>
                <div class="col-md-6">
                    <label for="apellido" class="form-label"><b>Apellido</b></label>
                    <InputText id="apellido" @bind-Value="Profesor.Apellido" class="form-control" />
                    <ValidationMessage For="() => Profesor.Apellido" class="text-danger" />
                </div>
            </div>

            <div class="row">
                <div class="col-md-4">
                    <label for="sexo" class="form-label"><b>Sexo</b></label>
                    <InputSelect id="sexo" @bind-Value="Profesor.Sexo" class="form-select">
                        <option checked="@(Profesor!.Sexo== "Masculino")" value="Masculino">Masculino</option>>
                        <option checked="@(Profesor!.Sexo== "Femenino")" value="Femenino">Femenino</option>
                    </InputSelect>
                    <ValidationMessage For="() => Profesor.Sexo" class="text-danger" />
                </div>
                <div class="col-md-4">
                    <label for="estadocivil" class="form-label"><b>Estado Civil</b></label>
                    <InputSelect id="estadocivil" @bind-Value="Profesor.EstadoCivil" class="form-select">
                        <option checked="@(Profesor!.EstadoCivil== "Casaso")" value="Casaso">Casado</option>
                        <option checked="@(Profesor!.EstadoCivil== "Divorciado")" value="Divorciado">Divorciado</option>
                        <option checked="@(Profesor!.EstadoCivil== "Separado")" value="Separado">Separado</option>
                        <option checked="@(Profesor!.EstadoCivil== "Soltero")" value="Soltero">Soltero</option>
                        <option checked="@(Profesor!.EstadoCivil== "Viudo")" value="Viudo">Viudo</option>
                    </InputSelect>
                    <ValidationMessage For="() => Profesor.EstadoCivil" class="text-danger" />
                </div>
                <div class="col-md-4">
                    <label for="ocupacion" class="form-label"><b>Ocupación</b></label>
                    <InputSelect id="ocupacion" @bind-Value="Profesor.Ocupacion" class="form-select">
                        <option checked="@(Profesor!.Ocupacion== "Abogado/a")" value="Abogado/a">Abogado/a</option>
                        <option checked="@(Profesor!.Ocupacion== "Profesor/a")" value="Profesor/a">Profesor/a</option>
                        <option checked="@(Profesor!.Ocupacion== "Médico/a")" value="Médico/a">Médico/a</option>
                        <option checked="@(Profesor!.Ocupacion== "Músico/a")" value="Músico/a">Músico/a</option>
                        <option checked="@(Profesor!.Ocupacion== "Veterinario/a")" value="Veterinario/a">Veterinario/a</option>
                        <option checked="@(Profesor!.Ocupacion== "Filósofo/a")" value="Filósofo/a">Filósofo/a</option>
                        <option checked="@(Profesor!.Ocupacion== "Administrador/a")" value="Administrador/a">Administrador/a</option>
                        <option checked="@(Profesor!.Ocupacion== "Psicólogo/a")" value="Psicólogo/a">Psicólogo/a</option>
                        <option checked="@(Profesor!.Ocupacion== "Economista")" value="Economista">Economista</option>
                        <option checked="@(Profesor!.Ocupacion== "Odontólogo/a")" value="Odontólogo/a">Odontólogo/a</option>
                    </InputSelect>
                    <ValidationMessage For="() => Profesor.Ocupacion" class="text-danger" />
                </div>
            </div>

            <div class="row">
                <div class="col-md-4">
                    <label for="tiposangre" class="form-label"><b>Tipo de Sangre</b></label>
                    <InputSelect id="tiposangre" @bind-Value="Profesor.TipoSangre" class="form-select">
                        <option checked="@(Profesor!.TipoSangre== "O -")" value="O -">O -</option>
                        <option checked="@(Profesor!.TipoSangre== "O +")" value="O +">O +</option>
                        <option checked="@(Profesor!.TipoSangre== "A -")" value="A -">A -</option>
                        <option checked="@(Profesor!.TipoSangre== "A +")" value="A +">A +</option>
                        <option checked="@(Profesor!.TipoSangre== "B -")" value="B -">B -</option>
                        <option checked="@(Profesor!.TipoSangre== "B +")" value="B +">B +</option>
                        <option checked="@(Profesor!.TipoSangre== "AB -")" value="AB -">AB -</option>
                        <option checked="@(Profesor!.TipoSangre== "AB +")" value="AB +">AB +</option>
                    </InputSelect>
                    <ValidationMessage For="() => Profesor.TipoSangre" class="text-danger" />
                </div>
                <div class="col-md-4">
                    <label for="nacionalidad" class="form-label"><b>Nacionalidad</b></label>
                    <InputSelect id="nacionalidad" @bind-Value="Profesor.Nacionalidad" class="form-select">
                        @foreach (var nacionalidad in Nacionalidades)
                        {
                            <option value="@nacionalidad.Nombre">@nacionalidad.Nombre</option>
                        }
                    </InputSelect>
                    <ValidationMessage For="() => Profesor.Nacionalidad" class="text-danger" />
                </div>
                <div class="col-md-4">
                    <label for="religion" class="form-label"><b>Religión</b></label>
                    <InputSelect id="religion" @bind-Value="Profesor.Religion" class="form-select">
                        @foreach (var religion in Religiones)
                        {
                            <option value="@religion.Nombre">@religion.Nombre</option>
                        }
                    </InputSelect>
                    <ValidationMessage For="() => Profesor.Religion" class="text-danger" />
                </div>
            </div>

            <div class="row">
                <div class="col-md-3">
                    <label for="telefono" class="form-label"><b>Teléfono</b></label>
                    <InputText id="telefono" @bind-Value="Profesor.Telefono" class="form-control" />
                    <ValidationMessage For="() => Profesor.Telefono" class="text-danger" />
                </div>
                <div class="col-md-3">
                    <label for="email" class="form-label"><b>Email</b></label>
                    <InputText id="email" @bind-Value="Profesor.Email" class="form-control" />
                    <ValidationMessage For="() => Profesor.Email" class="text-danger" />
                </div>
                <div class="col-md-6">
                    <label for="direccion" class="form-label"><b>Dirección</b></label>
                    <InputText id="direccion" @bind-Value="Profesor.Direccion" class="form-control" />
                    <ValidationMessage For="() => Profesor.Direccion" class="text-danger" />
                </div>
            </div>

            <div class="row">
                <div class="col-md-3">
                    <label for="titulogradoalcanzado" class="form-label"><b>Titulo Alcanzado</b></label>
                    <InputText id="titulogradoalcanzado" @bind-Value="Profesor.TituloGradoAlcanzado" class="form-control" />
                    <ValidationMessage For="() => Profesor.TituloGradoAlcanzado" class="text-danger" />
                </div>
                <div class="col-md-3">
                    <label for="facultad" class="form-label"><b>Facultad</b></label>
                    <InputSelect id="facultad" @bind-Value="Profesor.Facultad" class="form-select">
                        @foreach (var facultad in Facultades)
                        {
                            <option value="@facultad.Nombre">@facultad.Nombre</option>
                        }
                    </InputSelect>
                    <ValidationMessage For="() => Profesor.Facultad" class="text-danger" />
                </div>
                <div class="col-md-3">
                    <label for="gradoacademicoalcanzado" class="form-label"><b>Grado Academico</b></label>
                    <InputSelect id="gradoacademicoalcanzado" @bind-Value="Profesor.GradoAcademicoAlcanzado" class="form-select">
                        @foreach (var gradoacademicoalcanzado in GradoAcademicos)
                        {
                            <option value="@gradoacademicoalcanzado.Nombre">@gradoacademicoalcanzado.Nombre</option>
                        }
                    </InputSelect>
                    <ValidationMessage For="() => Profesor.GradoAcademicoAlcanzado" class="text-danger" />
                </div>
                <div class="col-md-3">
                    <label for="categoriaprofesional" class="form-label"><b>Categoria Profesional</b></label>
                    <InputSelect id="categoriaprofesional" @bind-Value="Profesor.CategoriaProfesional" class="form-select">
                        <option checked="@(Profesor!.CategoriaProfesional== "Profesor de primaria")" value="Profesor de primaria">Profesor de primaria</option>
                        <option checked="@(Profesor!.CategoriaProfesional== "Profesor de secundaria")" value="Profesor de secundaria">Profesor de secundaria</option>
                        <option checked="@(Profesor!.CategoriaProfesional== "Profesor universitario")" value="Profesor universitario">Profesor universitario</option>
                    </InputSelect>
                    <ValidationMessage For="() => Profesor.CategoriaProfesional" class="text-danger" />
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <label for="observaciones" class="form-label"><b>Observaciones</b></label>
                    <InputTextArea id="observaciones" @bind-Value="Profesor.Observaciones" class="form-control"></InputTextArea>
                    <ValidationMessage For="() => Profesor.Observaciones" class="text-danger" />
                </div>
            </div>

            <br>
            <div class="row">
                <div class="col-md-4">
                    <button type="submit" class="btn btn-primary"><b>Guardar</b></button> | <a href="/profesors" class="btn btn-primary"><b>Volver al Listado</b></a>
                </div>
            </div>
        </EditForm>
    </div>
}



@code {
    [SupplyParameterFromQuery]
    private int Id { get; set; }

    [SupplyParameterFromForm]
    private Profesor? Profesor { get; set; }

    public List<Nacionalidad> Nacionalidades = new List<Nacionalidad>();
    public List<Religion> Religiones = new List<Religion>();
    public List<Facultad> Facultades = new List<Facultad>();
    public List<GradoAcademico> GradoAcademicos = new List<GradoAcademico>();

    protected override async Task OnInitializedAsync()
    {
        using var context = DbFactory.CreateDbContext();
        Profesor ??= await context.Profesor.FirstOrDefaultAsync(m => m.Id == Id && m.Inactivo == false);

        if (Profesor is null)
        {
            NavigationManager.NavigateTo("notfound");
        }

        Nacionalidades = DB.Nacionalidad.ToList(); //Carga los datos de nacionalidades
        Religiones = DB.Religion.ToList(); //Carga los datos de religiones
        Facultades = DB.Facultad.ToList(); //Carga los datos de facultades
        GradoAcademicos = DB.GradoAcademico.ToList(); //Carga los datos de grado academicos
    }

    // To protect from overposting attacks, enable the specific properties you want to bind to.
    // For more information, see https://learn.microsoft.com/aspnet/core/blazor/forms/#mitigate-overposting-attacks.
    private async Task UpdateProfesor()
    {
        using var context = DbFactory.CreateDbContext();
        context.Attach(Profesor!).State = EntityState.Modified;

        try
        {
            await context.SaveChangesAsync();
        }
        catch (DbUpdateConcurrencyException)
        {
            if (!ProfesorExists(Profesor!.Id))
            {
                NavigationManager.NavigateTo("notfound");
            }
            else
            {
                throw;
            }
        }

        NavigationManager.NavigateTo("/profesors");
    }

    private bool ProfesorExists(int id)
    {
        using var context = DbFactory.CreateDbContext();
        return context.Profesor.Any(e => e.Id == id);
    }
}
